<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Horor Taxi</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" type="text/css" href="Korisnik.css">
    <script src="Scripts/jquery-1.10.2.js"></script>
    <script type="text/javascript">
        let lokacijaMapa = "";
        let blokada = "";
        $(document).ready(function () {

            let ulogovani = localStorage.getItem("ulogovani");
            let koje = "";
            let trenutniKorisnik = "";
            localStorage.setItem("zabrana", "0");
            $.ajax({
                type: 'POST',
                url: '/api/Find',
                data: JSON.stringify(ulogovani),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    if (data != null) {
                        if (data.Blokiran == true) {
                            localStorage.removeItem("ulogovani");
                            let koje = "";
                            let trenutniKorisnik = "";
                            $(location).attr('href', 'Index.html');
                        }
                        trenutniKorisnik = data;
                        localStorage.setItem("ulogovaniId", data.Id);
                        localStorage.setItem("ulogovaniUloga", data.Uloga);
                        $("#mapa").css("display", "none");
                        switch (data.Uloga) {
                            case 0:
                                koje = "musterija";
                                $(".musterija").css("display", "inline");
                                $("#pregledProfilaDivK").css("display", "none");
                                $("#izmenaProfilaDivK").css("display", "none");
                                $("#dodajVoznjuDivK").css("display", "none");
                                $("#tabelaMojeVoznjeK").css("display", "inline");
                                $("#pretragaK").css("display", "inline");
                                $("#mapa").css("display", "none");

                                $("#homeK").click();
                                $(".dispecer").css("display", "none");

                                $(".vozac").css("display", "none");
                                break;
                            case 1:
                                koje = "dispecer";
                                $(".musterija").css("display", "none");

                                $(".dispecer").css("display", "inline");
                                $("#pregledProfilaDivD").css("display", "none");
                                $("#izmenaProfilaDivD").css("display", "none");
                                $("#dodajVozacaDivD").css("display", "none");
                                $(".vozac").css("display", "none");
                                $("#dodajKomentarD").css("display", "none");
                                $("#prikaziKomentarD").css("display", "none");
                                $("#tabeleD").css("display", "inline");
                                $("#pretragaD1").css("display", "none");
                                $("#pretragaD2").css("display", "none");
                                $("#pretragaD3").css("display", "none");
                                $("#homeD").click();
                                break;
                            case 2:
                                koje = "vozac";
                                $(".dispecer").css("display", "none");

                                $(".musterija").css("display", "none");

                                $(".vozac").css("display", "inline");
                                $("#pregledProfilaDivV").css("display", "none");
                                $("#izmenaProfilaDivV").css("display", "none");
                                $("#dodajKomentarV").css("display", "none");
                                $("#prikaziKomentarV").css("display", "none");
                                $("#tabeleV").css("display", "inline");
                                $("#uspesnaVoznjaV").css("display", "none");
                                $("#dodajKomentarNeuspesnaV").css("display", "none");
                                $("#pretragaV1").css("display", "none");
                                $("#pretragaV2").css("display", "none");

                                localStorage.setItem("ulogovaniTip", data.Automobil.TipAutomobila);
                                localStorage.setItem("ulogovaniStatus", data.Zauzet);
                                $("#homeV").click();


                                break;

                        }
                    } else {
                        $(location).attr('href', 'Index.html');
                    }
                },
                error: function (errorData) {

                }
            })

            let timerId = setInterval(() => {

                let id = localStorage.getItem("ulogovaniId");
                let uloga = localStorage.getItem("ulogovaniUloga");
                let zauzetVozac = false;
                if (uloga == 0) {
                    $.ajax({
                        type: 'GET',
                        url: '/api/Korisnik/' + id,
                        async: false,
                        success: function (v) {

                            blokada = v.Blokiran;

                        }
                    })

                } else if (uloga == 2) {
                    $.ajax({
                        type: 'GET',
                        url: '/api/Vozac/' + id,
                        async: false,
                        success: function (v) {

                            blokada = v.Blokiran;
                            zauzetVozac = v.Zauzet;
                        }
                    })
                }
                if (uloga != 1) {

                    if (blokada == true) {
                        $(':button:not(.ac)').prop('disabled', true);

                    } else {
                        let z = localStorage.getItem("zabrana");
                        if (z == "0") {
                            $(':button:not(.noBtn)').prop('disabled', false);
                        } else if (z == "1") {
                            $(':button:not(.noBtn)').prop('disabled', true);
                        }
                        if (zauzetVozac == true) {
                            $('.zauzetVozacDugmici').prop('disabled', true);
                        }
                    }
                }


            }, 500);

            $("#odjavaK").click(function () {
                localStorage.removeItem("ulogovani");
                let koje = "";
                let trenutniKorisnik = "";
                $(location).attr('href', 'Index.html');
            });

            $("#homeK").click(function () {

                $("#pregledProfilaDivK").css("display", "none");
                $("#izmenaProfilaDivK").css("display", "none");
                $("#dodajVoznjuDivK").css("display", "none");
                $("#dodajKomentarK").css("display", "none");
                $("#prikaziKomentarK").css("display", "none");
                $("#dodajKomentarOtkaziK").css("display", "none");
                $("#pretragaK").css("display", "inline");
                $("#tabelaMojeVoznjeK").html("");
                $("#mapa").css("display", "none");

                $.ajax({
                    type: 'GET',
                    url: '/api/Voznja',
                    async: false,
                    success: function (data) {

                        let tableOfProducts = "<table  class=\"w3-border w3-centered w3-card w3-white\" cellpadding=\"7\" id=\"musterijaVoznje\"><tr><td colspan=\"13\"  align=\"center\"><b>Moje voznje</b></td></tr><tr><td>Datum</td><td>Početna lokacija</td><td>Odredište</td><td colspan=\"2\">Vozač</td><td colspan=\"2\">Dispečer</td><td>Iznos</td><td>Ocena</td><td>Tip Automobila</td><td>Status</td><td>Komentar</td><td></td><td></td></tr>";
                        for (voznja in data) {
                            if (data[voznja].Musterija == localStorage.getItem("ulogovaniId")) {
                                var date = new Date(data[voznja].Datum);
                                var month = date.getMonth() + 1;
                                var day = date.getDate();
                                var hours = date.getHours();
                                var minutes = date.getMinutes();

                                if (month < 10) month = '0' + month;
                                if (day < 10) day = '0' + day;
                                if (hours < 10) hours = '0' + hours;
                                if (minutes < 10) minutes = '0' + minutes;

                                var formatedDate = date.getFullYear() + "-" + month + "-" + day + " " + hours + ":" + minutes;

                                let vozacIme = "";
                                let vozacPrezime = "";

                                if (data[voznja].Vozac != -1) {

                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Vozac/' + data[voznja].Vozac,
                                        async: false,
                                        success: function (v) {
                                            vozacIme = v.Ime;
                                            vozacPrezime = v.Prezime;
                                        }
                                    })

                                }

                                let dispIme = "";
                                let dispPrezime = "";

                                if (data[voznja].Dispecer != -1) {

                                    $.ajax({
                                        type: 'GET',
                                        url: '/api/Dispecer/' + data[voznja].Dispecer,
                                        async: false,
                                        success: function (v) {
                                            dispIme = v.Ime;
                                            dispPrezime = v.Prezime;
                                        }
                                    })

                                }

                                tableOfProducts += `<tr><td>${formatedDate}</td><td>${data[voznja].PocetnaLokacija.Adresa.Ulica} <br/> ${data[voznja].PocetnaLokacija.Adresa.Mesto}</td><td>${data[voznja].Odrediste.Adresa.Ulica} <br/>  ${data[voznja].Odrediste.Adresa.Mesto}</td><td>${vozacIme}</td><td>${vozacPrezime}</td><td>${dispIme}</td><td>${dispPrezime}</td><td>${data[voznja].Iznos}</td>`;
                                tableOfProducts += `<td>${data[voznja].Komentar.Ocena}</td>`;
                                if (data[voznja].TipAutomobila == 0) {
                                    tableOfProducts += `<td>Svejedno</td>`;
                                } else if (data[voznja].TipAutomobila == 1) {
                                    tableOfProducts += `<td>Putnički</td>`;
                                } else if (data[voznja].TipAutomobila == 2) {
                                    tableOfProducts += `<td>Kombi</td>`;
                                }

                                switch (data[voznja].Status) {
                                    case 0:
                                        tableOfProducts += `<td>Kreirana-Na čekanju</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 1:
                                        tableOfProducts += `<td>Formirana</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 2:
                                        tableOfProducts += `<td>Obrađena</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 3:
                                        tableOfProducts += `<td>Prihvaćena</td>`;
                                        tableOfProducts += `<td>Nema komentara</td>`;
                                        break;
                                    case 4:
                                        tableOfProducts += `<td>Otkazana</td>`;
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClick(${data[voznja].Id});">Vidi komentar</button ></td>`;

                                        break;
                                    case 5:
                                        tableOfProducts += `<td>Uspešna</td>`;
                                        if (data[voznja].Komentar.Korisnik == -1) {
                                            tableOfProducts += `<td><button id="dodajKomentar${data[voznja].Id}" type="button" onclick="dodajKomentarClick(${data[voznja].Id});">Dodaj komentar</button ></td>`;

                                        } else {
                                            tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClick(${data[voznja].Id});">Vidi komentar</button ></td>`;

                                        }
                                        break;
                                    case 6:
                                        tableOfProducts += `<td>Neuspešna</td>`;
                                        tableOfProducts += `<td><button id="vidiKomentar${data[voznja].Id}" type="button" onclick="vidiKomentarClick(${data[voznja].Id});">Vidi komentar</button ></td>`;

                                        break;

                                }

                                if (data[voznja].Status == 0) {

                                    tableOfProducts += `<td><button  id="otkaziVoznju${data[voznja].Id}" type="button" onclick="otkaziVoznjuClick(${data[voznja].Id});">Otkazi Voznju</button></td>`;
                                    tableOfProducts += `<td><button  id="izmeniVoznju${data[voznja].Id}" type="button" onclick="izmeniVoznjuClick(${data[voznja].Id});">Izmeni Voznju</button></td>`;
                                } else {
                                    tableOfProducts += `<td><button class="noBtn" id="otkaziVoznju${data[voznja].Id}" type="button" onclick="otkaziVoznjuClick(${data[voznja].Id});" disabled>Otkazi Voznju</button></td>`;
                                    tableOfProducts += `<td><button class="noBtn" id="izmeniVoznju${data[voznja].Id}" type="button" onclick="izmeniVoznjuClick(${data[voznja].Id});" disabled>Izmeni Voznju</button></td>`;

                                }
                            }
                        }
                        tableOfProducts += "</table>";
                        $("#tabelaMojeVoznjeK").append(tableOfProducts);
                    }
                });


                $("#tabelaMojeVoznjeK").css("display", "inline");


            });
            $("#pregledProfilaK").click(function () {

                $("#pregledProfilaDivK").css("display", "inline");
                $("#izmenaProfilaDivK").css("display", "none");
                $("#dodajVoznjuDivK").css("display", "none");
                $("#tabelaMojeVoznjeK").css("display", "none");
                $("#mapa").css("display", "none");

                $("#pretragaK").css("display", "none");

                $("#korisnickoImeK").text(trenutniKorisnik.KorisnickoIme);
                $("#lozinkaK").text(trenutniKorisnik.Lozinka);
                $("#imeK").text(trenutniKorisnik.Ime);
                $("#prezimeK").text(trenutniKorisnik.Prezime);
                if (trenutniKorisnik.Pol == 0) {
                    let musko = "<i class=\"fa fa-mars w3-xlarge\"></i>";
                    $("#polK").html(musko);
                } else {
                    let zensko = "<i class=\"fa fa-venus w3-xlarge\"></i>";
                    $("#polK").html(zensko);
                }
                $("#jmbgK").html(trenutniKorisnik.JMBG);
                $("#kontaktK").html(trenutniKorisnik.Kontakt);
                $("#emailK").html(trenutniKorisnik.Email);

            });

            $("#izmenaProfilaK").click(function () {

                $("#izmenaProfilaDivK").css("display", "inline");
                $("#pregledProfilaDivK").css("display", "none");
                $("#dodajVoznjuDivK").css("display", "none");
                $("#tabelaMojeVoznjeK").css("display", "none");
                $("#pretragaK").css("display", "none");
                $("#mapa").css("display", "none");

                let izmena = "<table class=\"w3-large\" border=1>";
                izmena += " <tr><td>Korisničko ime</td><td><input type=\"text\" name=\"KorisnickoIme\" id=\"korisnickoime\" value=\"" + trenutniKorisnik.KorisnickoIme + "\" pattern=\".{4,}\" minlength=\"4\" maxlength=\"13\" required /></td></tr>";
                izmena += " <tr><td>Lozinka</td><td><input type=\"text\" name=\"Lozinka\" id=\"lozinka1\" value=\"" + trenutniKorisnik.Lozinka + "\" pattern=\".{4,}\" minlength=\"4\" maxlength=\"13\" required /></td></tr>";
                izmena += " <tr><td>Ime</td><td><input type=\"text\" name=\"Ime\" id=\"ime1\" value=\"" + trenutniKorisnik.Ime + "\" minlength=\"2\" maxlength=\"13\" pattern=\"^[^0-9]+$\" required /></td></tr>";
                izmena += " <tr><td>Prezime</td><td><input type=\"text\" name=\"Prezime\" value=\"" + trenutniKorisnik.Prezime + "\" id=\"prezime1\" minlength=\"2\" maxlength=\"13\" pattern=\"^[^0-9]+$\" required /></td></tr>";

                izmena += " <tr><td>JMBG</td><td><input type=\"text\" name=\"JMBG\" id=\"jmbg1\" pattern=\"[0-9]{13}\" minlength=\"13\" maxlength=\"13\" value=\"" + trenutniKorisnik.JMBG + "\" required /></td></tr>";
                izmena += " <tr><td>Kontakt</td><td><input type=\"text\" name=\"Kontakt\" id=\"kontakt1\" value=\"" + trenutniKorisnik.Kontakt + "\"  pattern=\"[0-9]{6,14}\" minlength=\"6\" maxlength=\"14\" required /></td></tr>";
                izmena += " <tr><td>Email</td><td><input type=\"email\" name=\"Email\" id=\"email1\" value=\"" + trenutniKorisnik.Email + "\" pattern=\"[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$\" required /></td></tr></table>";

                $("#tabelaIzmenaK").html(izmena);

            });

            $("#izmeniK").click(function () {
                let v = document.getElementById("korisnickoime");
                let v1 = document.getElementById("lozinka1");
                let v2 = document.getElementById("ime1");
                let v3 = document.getElementById("prezime1");
                let v5 = document.getElementById("jmbg1");
                let v6 = document.getElementById("kontakt1");
                let v7 = document.getElementById("email1");
                if (!v.checkValidity() && !v1.checkValidity() && !v2.checkValidity() && !v3.checkValidity() && !v5.checkValidity() && !v6.checkValidity() && !v7.checkValidity()) {
                    alert("Popunite polja za registraciju!");
                } else if (!v.checkValidity() || !v1.checkValidity() || !v2.checkValidity() || !v3.checkValidity() || !v5.checkValidity() || !v6.checkValidity() || !v7.checkValidity()) {
                    let greska = "Niste dobro uneli:\n";
                    if (!v.checkValidity()) {
                        greska += "-Korisničko ime\n";
                    }
                    if (!v1.checkValidity()) {
                        greska += "-Lozinku\n";
                    }
                    if (!v2.checkValidity()) {
                        greska += "-Ime\n";
                    }
                    if (!v3.checkValidity()) {
                        greska += "-Prezime\n";
                    }

                    if (!v5.checkValidity()) {
                        greska += "-JMBG\n";
                    }
                    if (!v6.checkValidity()) {
                        greska += "-Kontakt\n";
                    }
                    if (!v7.checkValidity()) {
                        greska += "-Email\n";
                    }
                    alert(greska);
                } else {
                    let jmbg = `${$('#jmbgVD').val()}`;
                    let danRodjenja = jmbg.substring(0, 2);
                    let mesecRodjenja = jmbg.substring(2, 4);
                    let godinaRodjenja = jmbg.substring(4, 7);
                    danRodjenja = parseInt(danRodjenja);
                    mesecRodjenja = parseInt(mesecRodjenja);
                    godinaRodjenja = parseInt(godinaRodjenja);
                    if (danRodjenja <= 0 || danRodjenja > 31 || mesecRodjenja <= 0 || mesecRodjenja > 12 || (godinaRodjenja > 18 && godinaRodjenja < 900)) {
                        alert("JMBG je neispravan!");
                    } else {

                        let korisnik = {
                            Id: trenutniKorisnik.Id,
                            KorisnickoIme: `${$('#korisnickoime').val()}`,
                            Lozinka: `${$('#lozinka1').val()}`,
                            Ime: `${$('#ime1').val()}`,
                            Prezime: `${$('#prezime1').val()}`,
                            Pol: trenutniKorisnik.Pol,
                            JMBG: `${$('#jmbg1').val()}`,
                            Kontakt: `${$('#kontakt1').val()}`,
                            Email: `${$('#email1').val()}`,
                            Voznje: trenutniKorisnik.Voznje,
                            Uloga: trenutniKorisnik.Uloga,
                        };

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Korisnik/' + trenutniKorisnik.Id,
                            data: JSON.stringify(korisnik),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {
                                if (data) {
                                    alert("Uspešno ste izmenili podatke.");
                                    localStorage.setItem("ulogovani", korisnik.KorisnickoIme);
                                    $(location).attr('href', 'Korisnik.html');
                                }
                                else {
                                    alert("Polja nisu pravilno popunjena ili je korisničko ime zauzeto!");
                                }
                            },
                            error: function (errorData) {

                            }
                        })
                    }
                }
            });

            $("#PlusK").click(function () {

                $("#izmenaProfilaDivK").css("display", "none");
                $("#pregledProfilaDivK").css("display", "none");
                $("#dodajVoznjuDivK").css("display", "inline");
                $("#tabelaMojeVoznjeK").css("display", "none");
                $("#pretragaK").css("display", "none");
                $("#mapa").css("display", "inline");

            });

            $("#dodajVoznjuK").click(function () {

                let lokacija2 = lokacijaMapa;
                if (lokacija2 == "") {
                    alert("Izaberite lokaciju!");
                } else {


                    lokacijaMapa = "";

                    let e = document.getElementById('autoK');
                    let selValue = e.options[e.selectedIndex].text;

                    let Voznja = {
                        Musterija: trenutniKorisnik.Id,
                        PocetnaLokacija: lokacija2,
                        TipAutomobila: selValue,
                        Status: "Kreirana",

                    };
                    $.ajax({
                        type: 'POST',
                        url: '/api/Voznja',
                        data: JSON.stringify(Voznja),
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {
                            if (data) {
                                alert("Uspešno ste dodali vožnju!");
                                $(location).attr('href', 'Korisnik.html');
                            }
                            else {
                                alert("Vožnja nije dodata!");
                            }
                        },
                        error: function (errorData) {

                        }
                    })
                }
            });
        });
    </script>
</head>
<body>
    <div class="w3-container w3-content" style="margin-top:200px" id="mapa">
        <p style="margin-top:50px;margin-left:30px">Kliknite na željenu lokaciju</p>
        
        <div  id="map" style="width:700px;height: 400px;margin-top:30px;margin-left:30px"></div>
    </div>
  
    <div class="musterija">
        <div class="w3-top">
            <div class="w3-bar " style=" background-color:#808080">
                <img class="w3-bar-item w3-left w3-small " src="logo.jpg" height="60" width="60" />
                <a href="#" id="homeK" class="w3-bar-item w3-button w3-padding-large w3-large w3-left " style=" background-color:#808080"><i class="fa fa-home"></i></a>
                <div class="w3-dropdown-hover w3-hide-small w3-large w3-left">
                    <button class="w3-button w3-padding-large ac" title="Account"><i class="fa fa-user"></i></button>
                    <div class="w3-dropdown-content w3-card-4 w3-bar-block" style="width:300px">
                        <a href="#" id="pregledProfilaK" class="w3-bar-item w3-button">Pregled profila</a>
                        <a href="#" id="izmenaProfilaK" class="w3-bar-item w3-button">Izmeni profil</a>
                        <a href="#" id="odjavaK" class="w3-bar-item w3-button">Odjavi se</a>

                    </div>
                </div>
                <a href="#" id="PlusK" class="w3-bar-item w3-button w3-padding-large w3-large w3-left" title="Nova vožnja"><i class="fa fa-plus"></i></a>
            </div>
        </div>

        <div class="w3-container w3-content" style="max-width:1700px;margin-top:80px">
            <div id="pregledProfilaDivK">
                <div class="w3-card w3-left w3-padding-large">
                    <h5 id="korisnickoImeK" class="fa fa-user-circle w3-xxlarge"></h5>
                    <br />
                    <p id="lozinkaK" class="fa fa-key w3-xlarge"></p><br />
                    <p id="imeK" class="fa fa-genderless w3-xlarge"></p><br />
                    <p id="prezimeK" class="fa fa-genderless w3-xlarge"></p><br />
                    <p id="polK"></p>
                    <p id="jmbgK" class="fa fa-birthday-cake w3-xlarge"></p><br />
                    <p id="kontaktK" class="fa fa-phone w3-xlarge"></p><br />
                    <p id="emailK" class="fa fa-at w3-xlarge"></p><br />
                </div>
            </div>

            <div id="izmenaProfilaDivK">
                <div id="tabelaIzmenaK">

                </div>
                <button class="w3-left" id="izmeniK" type="button">Izmeni</button>
            </div>

            <div id="dodajVoznjuDivK">
                <div id="tabelaDodajVoznju">

                    <table border="1" class="w3-card w3-white">
                        <!--<tr><td colspan="2">Vaša lokacija</td></tr>
                <tr><td>X</td><td><input type="number" name="X" id="xK" required /></td></tr>
                <tr><td>Y</td><td><input type="number" name="Y" id="yK" required /></td></tr>
                <tr><td colspan="2">Adresa</td></tr>
                <tr><td>Ulica</td><td><input type="text" name="Ulica" id="ulicaK" required /></td></tr>
                <tr><td>Broj</td><td><input type="text" name="Broj" id="brojK" required /></td></tr>
                <tr><td>Mesto</td><td><input type="text" name="Mesto" id="mestoK" required /></td></tr>
                <tr><td>ZIP</td><td><input type="number" name="Zip" id="zipK" required /></td></tr>-->
                        <tr>
                            <td>Tip Automobila</td>
                            <td>
                                <select name="Auto" id="autoK">
                                    <option>Svejedno</option>
                                    <option>Putnički</option>
                                    <option>Kombi</option>
                                </select>
                            </td>
                        </tr>
                        <tr><td colspan="2"><button id="dodajVoznjuK" type="button">Dodaj</button></td></tr>
                    </table>
                </div>

            </div>




            <div class="w3-col m10" style="margin-top:20px">

                <div
                     
                     id="tabelaMojeVoznjeK">

                </div>

            </div>

            <div id="izmenaVoznjeK">

            </div>

            <div class="w3-col m2">
                <div id="dodajKomentarK" class="w3-right">
                    <table border="1" class="w3-card w3-white">
                        <tr>
                            <td colspan="2">Dodaj Komentar</td>
                        </tr>
                        <tr>
                            <td>Opis</td>
                            <td><input type="text" name="Opis" id="opisK" required /></td>
                        </tr>
                        <tr>
                            <td>Ocena</td>
                            <td><input type="range" name="Ocena" id="ocenaK" min="1" max="5" /></td>
                        </tr>
                        <tr>
                            <td> <button onclick="dodajKomentarDugmeK();" type="button">Dodaj</button></td>
                            <td> <button onclick="otkaziKomentarDugmeK();" type="button">Otkazi</button></td>
                        </tr>
                    </table>
                </div>

                <div id="dodajKomentarOtkaziK" class="w3-right">
                    <table border="1" class="w3-card w3-white">
                        <tr>
                            <td colspan="2">Dodaj Komentar</td>
                        </tr>
                        <tr>
                            <td>Opis</td>
                            <td><input type="text" name="Opis" id="opisKO" required /></td>
                        </tr>
                        <tr>
                            <td>Ocena</td>
                            <td><input type="range" name="Ocena" id="ocenaKO" min="1" max="5" value="1" disabled /></td>
                        </tr>
                        <tr>
                            <td colspan="2"> <button class="noBtn" onclick="dodajKomentarOtkaziDugmeK();" type="button">Dodaj</button></td>

                        </tr>
                    </table>
                </div>

                <div id="prikaziKomentarK" class="w3-right w3-large w3-card w3-white">
                    <div class="w3-card w3-padding-large">

                        <p id="opisP" class="fa fa-pencil-alt"></p><br />
                        <p id="datumP" class="fa fa-calendar-alt"></p><br />
                        <p id="korisnikP" class="fa fa-user-circle"></p><br />
                        <p id="OcenaP" class="fa fa-star"></p><br />
                        <button id="gasiKom" onclick="zatvoriKomentarK();" class="fa fa-times"></button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script>

        function myMap() {

            var mapCanvas = document.getElementById("map");
            var myCenter = new google.maps.LatLng(45.251984, 19.837242);
            var mapOptions = { center: myCenter, zoom: 14 };
            var map = new google.maps.Map(mapCanvas, mapOptions);
            google.maps.event.addListener(map, 'click', function (event) {
                placeMarker(map, event.latLng);
            });
        }

        function placeMarker(map, location) {
            var marker = new google.maps.Marker({
                position: location,
                map: map
            });
            let lok = displayLocation(location.lat(), location.lng());

            var infowindow = new google.maps.InfoWindow({
                content: 'X: ' + location.lat() + '<br>Y: ' + location.lng() + '<br> ' + lok.Ulica + '<br> ' + lok.Mesto

            });
            infowindow.open(map, marker);


        }

        function displayLocation(latitude, longitude) {
            var request = new XMLHttpRequest();
            let adresaM = "";
            var method = 'GET';
            var url = 'http://maps.googleapis.com/maps/api/geocode/json?latlng='
                + latitude + ',' + longitude + '&sensor=true';
            var async = false;

            request.open(method, url, async);
            request.onreadystatechange = function () {
                if (request.readyState == 4 && request.status == 200) {
                    var data = JSON.parse(request.responseText);
                    var address = data.results[0];
                    var value = address.formatted_address.split(",");
                    count = value.length;
                    country = value[count - 1];
                    state = value[count - 2];
                    city = value[count - 3];

                    // document.write(address.formatted_address);
                    adresaM = {
                        Ulica: city,
                        Mesto: state,

                    }
                    lokacijaMapa = {
                        X: latitude,
                        Y: longitude,
                        Adresa: adresaM,
                    };

                }
            };
            request.send();
            return adresaM;
        };


    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBrjeABCsOwW1rhi7eW6_b_fWF8OK2HeiA&callback=myMap"></script>

</body>
</html>